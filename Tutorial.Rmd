---
title: "Model Microbiome Tutorial"
author: "Dietrich Epp Schmidt"
date: "2/21/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:
```{r}
# load required packages ####

library(Model.Microbiome)
library(ggplot2)
library(vegan)
#library(dplyr)
#library(plyr)
library(phyloseq)
library()
```

```{r}
# mostly universal taxa
# benchmark with total = 75; different sequencing depth (low sparsity)
C.D500<-suppressWarnings(benchmark.MM(reps=100, commonN=73, groupN=1, singleN=1, D=500, V=250))
C.D1000<-suppressWarnings(benchmark.MM(reps=100, commonN=73, groupN=1, singleN=1, D=1000, V=500))
C.D2000<-suppressWarnings(benchmark.MM(reps=100, commonN=73, groupN=1, singleN=1, D=2000, V=1000))
C.D10000<-suppressWarnings(benchmark.MM(reps=100, commonN=73, groupN=1, singleN=1, D=10000, V=5000))

# increasing rare taxa (medium-low sparsity)
# benchmark with total = 75; different sequencing depth
G.D500<-suppressWarnings(benchmark.MM(reps=100, commonN=50, groupN=15, singleN=10, D=500, V=250))
G.D1000<-suppressWarnings(benchmark.MM(reps=100, commonN=50, groupN=15, singleN=10, D=1000, V=500))
G.D2000<-suppressWarnings(benchmark.MM(reps=100, commonN=50, groupN=15, singleN=10, D=2000, V=1000))
G.D10000<-suppressWarnings(benchmark.MM(reps=100, commonN=50, groupN=15, singleN=10, D=10000, V=5000))

# even distribution of rare taxa (medium sparcity)
# benchmark with total = 75; different sequencing depth
E.D500<-suppressWarnings(benchmark.MM(reps=100, commonN=25, groupN=25, singleN=25, D=500, V=250))
E.D1000<-suppressWarnings(benchmark.MM(reps=100, commonN=25, groupN=25, singleN=25, D=1000, V=500))
E.D2000<-suppressWarnings(benchmark.MM(reps=100, commonN=25, groupN=25, singleN=25, D=2000, V=1000))
E.D10000<-suppressWarnings(benchmark.MM(reps=100, commonN=25, groupN=25, singleN=25, D=10000, V=5000))

# (medium-high sparsity)
# benchmark with total = 75; different sequencing depth
S.D500<-suppressWarnings(benchmark.MM(reps=100, commonN=15, groupN=20, singleN=40, D=500, V=250))
S.D1000<-suppressWarnings(benchmark.MM(reps=100, commonN=15, groupN=20, singleN=40, D=1000, V=500))
S.D2000<-suppressWarnings(benchmark.MM(reps=100, commonN=15, groupN=20, singleN=40, D=2000, V=1000)) 
S.D10000<-suppressWarnings(benchmark.MM(reps=100, commonN=15, groupN=20, singleN=40, D=10000, V=5000)) 

# (High sparsity)
# benchmark with total = 75; different sequencing depth
V.D500<-suppressWarnings(benchmark.MM(reps=100, commonN=10, groupN=15, singleN=50, D=500, V=250))
V.D1000<-suppressWarnings(benchmark.MM(reps=100, commonN=10, groupN=15, singleN=50, D=1000, V=500))
V.D2000<-suppressWarnings(benchmark.MM(reps=100, commonN=10, groupN=15, singleN=50, D=2000, V=1000))
V.D10000<-suppressWarnings(benchmark.MM(reps=100, commonN=10, groupN=15, singleN=50, D=10000, V=5000))
```



```{R}
# PERMANOVA output ####

# benchmark with total = 75; different sequencing depth
P_C.D500<-ext.PERMANOVA(C.D500)
P_C.D1000<-ext.PERMANOVA(C.D1000)
P_C.D2000<-ext.PERMANOVA(C.D2000)
P_C.D10000<-ext.PERMANOVA(C.D10000)
# seq depth at mostly universal taxa
# benchmark with total = 75; different sequencing depth
P_G.D500<-ext.PERMANOVA(G.D500)
P_G.D1000<-ext.PERMANOVA(G.D1000)
P_G.D2000<-ext.PERMANOVA(G.D2000)
P_G.D10000<-ext.PERMANOVA(G.D10000)

# seq depth at mostly universal taxa
# benchmark with total = 75; different sequencing depth
P_S.D500<-ext.PERMANOVA(S.D500)
P_S.D1000<-ext.PERMANOVA(S.D1000)
P_S.D2000<-ext.PERMANOVA(S.D2000)
P_S.D10000<-ext.PERMANOVA(S.D10000)

# seq depth at mostly universal taxa
# benchmark with total = 75; different sequencing depth
P_E.D500<-ext.PERMANOVA(E.D500)
P_E.D1000<-ext.PERMANOVA(E.D1000)
P_E.D2000<-ext.PERMANOVA(E.D2000)
P_E.D10000<-ext.PERMANOVA(E.D10000)

P_V.D500<-ext.PERMANOVA(V.D500)
P_V.D1000<-ext.PERMANOVA(V.D1000)
P_V.D2000<-ext.PERMANOVA(V.D2000)
P_V.D10000<-ext.PERMANOVA(V.D10000)
```

```{r}
# prepare permanova data for plotting ####

P_C.D500$Level<-c(rep(500, 100))
P_C.D1000$Level<-c(rep(1000, 100))
P_C.D2000$Level<-c(rep(2000, 100))
P_C.D10000$Level<-c(rep(10000, 100))

P_G.D500$Level<-c(rep(500, 100))
P_G.D1000$Level<-c(rep(1000, 100))
P_G.D2000$Level<-c(rep(2000, 100))
P_G.D10000$Level<-c(rep(10000, 100))

P_E.D500$Level<-c(rep(500, 100))
P_E.D1000$Level<-c(rep(1000, 100))
P_E.D2000$Level<-c(rep(2000, 100))
P_E.D10000$Level<-c(rep(10000, 100))

P_S.D500$Level<-c(rep(500, 100))
P_S.D1000$Level<-c(rep(1000, 100))
P_S.D2000$Level<-c(rep(2000, 100))
P_S.D10000$Level<-c(rep(10000, 100))

P_V.D500$Level<-c(rep(500, 100))
P_V.D1000$Level<-c(rep(1000, 100))
P_V.D2000$Level<-c(rep(2000, 100))
P_V.D10000$Level<-c(rep(10000, 100))
```

```{r}
# permanova plots

Permanova.C<-do.call("rbind", list(P_C.D500,P_C.D1000,P_C.D2000,P_C.D10000))
Permanova.C<-melt(data=Permanova.C, id.vars="Level", measure.vars = c("raw", "scaled", "eRare", "pRare", "limmaVST", "deseqVST"))
library(ggplot2)

Permanova.C2<-data_summary2(Permanova.C, varname="value", groupnames=c("Level", "variable"))
Permanova.C<-data_summary(Permanova.C, varname="value", groupnames=c("Level", "variable"))

ggplot(Permanova.C, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=value-sd, ymax=value+sd), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("PERMANOVA R.sq. Index Value (Mean +/- se)")+
  theme_classic()


ggplot(Permanova.C2, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("PERMANOVA R.sq. Index Value (Median +/- min/max)")+
  theme_classic()
```

```{r}
# permanova plots

Permanova.G<-do.call("rbind", list(P_G.D500,P_G.D1000,P_G.D2000,P_G.D10000))
Permanova.G<-melt(data=Permanova.G, id.vars="Level", measure.vars = c("raw", "scaled", "eRare", "pRare", "limmaVST", "deseqVST"))

Permanova.G2<-data_summary2(Permanova.G, varname="value", groupnames=c("Level", "variable"))
Permanova.G<-data_summary(Permanova.G, varname="value", groupnames=c("Level", "variable"))

ggplot(Permanova.G, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=value-sd, ymax=value+sd), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("PERMANOVA R.sq. Index Value (Mean +/- se)")+
  theme_classic()


ggplot(Permanova.G2, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("PERMANOVA R.sq. Index Value (Median +/- min/max)")+
  theme_classic()
```

```{r}
# permanova plots

Permanova.E<-do.call("rbind", list(P_E.D500,P_E.D1000,P_E.D2000,P_E.D10000))
Permanova.E<-melt(data=Permanova.E, id.vars="Level", measure.vars = c("raw", "scaled", "eRare", "pRare", "limmaVST", "deseqVST"))

Permanova.E2<-data_summary2(Permanova.E, varname="value", groupnames=c("Level", "variable"))
Permanova.E<-data_summary(Permanova.E, varname="value", groupnames=c("Level", "variable"))

ggplot(Permanova.E, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=value-sd, ymax=value+sd), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("PERMANOVA R.sq. Index Value (Mean +/- se)")+
  theme_classic()


ggplot(Permanova.E2, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("PERMANOVA R.sq. Index Value (Median +/- min/max)")+
  theme_classic()
```

```{r}
# permanova plots

Permanova.S<-do.call("rbind", list(P_S.D500,P_S.D1000,P_S.D2000,P_S.D10000))
Permanova.S<-melt(data=Permanova.S, id.vars="Level", measure.vars = c("raw", "scaled", "eRare", "pRare", "limmaVST", "deseqVST"))

Permanova.S2<-data_summary2(Permanova.S, varname="value", groupnames=c("Level", "variable"))
Permanova.S<-data_summary(Permanova.S, varname="value", groupnames=c("Level", "variable"))

ggplot(Permanova.S, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=value-sd, ymax=value+sd), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("PERMANOVA R.sq. Index Value (Mean +/- se)")+
  theme_classic()


ggplot(Permanova.S2, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("PERMANOVA R.sq. Index Value (Median +/- min/max)")+
  theme_classic()
```


```{r}
# permanova plots

Permanova.V<-do.call("rbind", list(P_V.D500,P_V.D1000,P_V.D2000,P_V.D10000))
Permanova.V<-melt(data=Permanova.V, id.vars="Level", measure.vars = c("raw", "scaled", "eRare", "pRare", "limmaVST", "deseqVST"))

Permanova.V2<-data_summary2(Permanova.V, varname="value", groupnames=c("Level", "variable"))
Permanova.V<-data_summary(Permanova.V, varname="value", groupnames=c("Level", "variable"))

ggplot(Permanova.V, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=value-sd, ymax=value+sd), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("PERMANOVA R.sq. Index Value (Mean +/- se)")+
  theme_classic()


ggplot(Permanova.V2, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("PERMANOVA R.sq. Index Value (Median +/- min/max)")+
  theme_classic()
```
```{r}
Permanova.C$sparsity<-c(rep(1, 24))
Permanova.E$sparsity<-c(rep(3, 24))
Permanova.G$sparsity<-c(rep(2, 24))
Permanova.S$sparsity<-c(rep(4, 24))
Permanova.V$sparsity<-c(rep(5, 24))

Permanova.stats<-do.call("rbind", list(Permanova.C, Permanova.E, Permanova.G, Permanova.S, Permanova.V))
Permanova.stats$sparsity<-as.factor(Permanova.stats$sparsity)
with(Permanova.stats, summary(aov(value~variable*sparsity)))
with(Permanova.stats, TukeyHSD(aov(value~variable*sparsity)))
```


```{r}
# LII output ####

# benchmark with total = 75; different sequencing depth
L_C.D500<-ext.LII(C.D500)
L_C.D1000<-ext.LII(C.D1000)
L_C.D2000<-ext.LII(C.D2000)
L_C.D10000<-ext.LII(C.D10000)
# seq depth at mostly universal taxa
# benchmark with total = 75; different sequencing depth
L_G.D500<-ext.LII(G.D500)
L_G.D1000<-ext.LII(G.D1000)
L_G.D2000<-ext.LII(G.D2000)
L_G.D10000<-ext.LII(G.D10000)

# seq depth at mostly universal taxa
# benchmark with total = 75; different sequencing depth
L_E.D500<-ext.LII(E.D500)
L_E.D1000<-ext.LII(E.D1000)
L_E.D2000<-ext.LII(E.D2000)
L_E.D10000<-ext.LII(E.D10000)

# seq depth at mostly universal taxa
# benchmark with total = 75; different sequencing depth
L_S.D500<-ext.LII(S.D500)
L_S.D1000<-ext.LII(S.D1000)
L_S.D2000<-ext.LII(S.D2000)
L_S.D10000<-ext.LII(S.D10000)

L_V.D500<-ext.LII(S.D500)
L_V.D1000<-ext.LII(S.D1000)
L_V.D2000<-ext.LII(S.D2000)
L_V.D10000<-ext.LII(S.D10000)

# prepare Loss of information for plotting

L_C.D500$Level<-c(rep(500, 100))
L_C.D1000$Level<-c(rep(1000, 100))
L_C.D2000$Level<-c(rep(2000, 100))
L_C.D10000$Level<-c(rep(10000, 100))

L_G.D500$Level<-c(rep(500, 100))
L_G.D1000$Level<-c(rep(1000, 100))
L_G.D2000$Level<-c(rep(2000, 100))
L_G.D10000$Level<-c(rep(10000, 100))

L_E.D500$Level<-c(rep(500, 100))
L_E.D1000$Level<-c(rep(1000, 100))
L_E.D2000$Level<-c(rep(2000, 100))
L_E.D10000$Level<-c(rep(10000, 100))

L_S.D500$Level<-c(rep(500, 100))
L_S.D1000$Level<-c(rep(1000, 100))
L_S.D2000$Level<-c(rep(2000, 100))
L_S.D10000$Level<-c(rep(10000, 100))

L_V.D500$Level<-c(rep(500, 100))
L_V.D1000$Level<-c(rep(1000, 100))
L_V.D2000$Level<-c(rep(2000, 100))
L_V.D10000$Level<-c(rep(10000, 100))

```

```{R}
# plot LII ####
LII.C<-do.call("rbind", list(L_C.D500,L_C.D1000,L_C.D2000,L_C.D10000))
LII.C<-melt(data=LII.C, id.vars="Level", measure.vars = c("raw", "scaled", "eRare", "pRare", "limmaVST", "deseqVST"))
LII.C<-data_summary2(LII.C, varname="value", groupnames=c("Level", "variable"))

LII.C500<-LII.C[LII.C$Level==500,]
LII.C1000<-LII.C[LII.C$Level==1000,]
LII.C2000<-LII.C[LII.C$Level==2000,]
LII.C10000<-LII.C[LII.C$Level==10000,]

ggplot(LII.C, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line()+
  geom_point()+
  xlab("Seq. Depth")+
  ylab("Lost Information Index Value (Median +/- min/max)")+
  theme_classic()

```

```{R}


LII.G<-do.call("rbind", list(L_G.D500,L_G.D1000,L_G.D2000,L_G.D10000))
LII.G<-melt(data=LII.G, id.vars="Level", measure.vars = c("raw", "scaled", "eRare", "pRare", "limmaVST", "deseqVST"))
LII.G<-data_summary2(LII.G, varname="value", groupnames=c("Level", "variable"))

LII.G500<-LII.G[LII.G$Level==500,]
LII.G1000<-LII.G[LII.G$Level==1000,]
LII.G2000<-LII.G[LII.G$Level==2000,]
LII.G10000<-LII.G[LII.G$Level==10000,]

ggplot(LII.G, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line()+
  geom_point()+
  xlab("Seq. Depth")+
  ylab("Lost Information Index Value (Median +/- min/max)")+
  theme_classic()

```

```{R}

LII.E<-do.call("rbind", list(L_E.D500,L_E.D1000,L_E.D2000,L_E.D10000))
LII.E<-melt(data=LII.E, id.vars="Level", measure.vars = c("raw", "scaled", "eRare", "pRare", "limmaVST", "deseqVST"))
LII.E<-data_summary2(LII.E, varname="value", groupnames=c("Level", "variable"))

LII.E500<-LII.E[LII.E$Level==500,]
LII.E1000<-LII.E[LII.E$Level==1000,]
LII.E2000<-LII.E[LII.E$Level==2000,]
LII.E10000<-LII.E[LII.E$Level==10000,]

ggplot(LII.E, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("Lost Information Index Value (Median +/- min/max)")+
  theme_classic()

```

```{R}

LII.S<-do.call("rbind", list(L_S.D500,L_S.D1000,L_S.D2000,L_S.D10000))
LII.S<-melt(data=LII.S, id.vars="Level", measure.vars = c("raw", "scaled", "eRare", "pRare", "limmaVST", "deseqVST"))
LII.S<-data_summary2(LII.S, varname="value", groupnames=c("Level", "variable"))

LII.S500<-LII.S[LII.S$Level==500,]
LII.S1000<-LII.S[LII.S$Level==1000,]
LII.S2000<-LII.S[LII.S$Level==2000,]
LII.S10000<-LII.S[LII.S$Level==10000,]

ggplot(LII.S, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("Lost Information Index Value (Median +/- min/max)")+
  theme_classic()

```

```{R}

LII.V<-do.call("rbind", list(L_V.D500,L_V.D1000,L_V.D2000,L_V.D10000))
LII.V<-melt(data=LII.V, id.vars="Level", measure.vars = c("raw", "scaled", "eRare", "pRare", "limmaVST", "deseqVST"))
LII.V<-data_summary2(LII.V, varname="value", groupnames=c("Level", "variable"))

LII.V500<-LII.V[LII.V$Level==500,]
LII.V1000<-LII.V[LII.V$Level==1000,]
LII.V2000<-LII.V[LII.V$Level==2000,]
LII.V10000<-LII.V[LII.V$Level==10000,]

ggplot(LII.V, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("Lost Information Index Value (Median +/- min/max)")+
  theme_classic()

```


```{r}
with(LII.V, plot())
```


```{r}
LII.C$sparsity<-c(rep(1, 24))
LII.E$sparsity<-c(rep(3, 24))
LII.G$sparsity<-c(rep(2, 24))
LII.S$sparsity<-c(rep(4, 24))
LII.V$sparsity<-c(rep(5, 24))

L.stats<-do.call("rbind", list(LII.C, LII.E, LII.G, LII.S, LII.V))
L.stats$sparsity<-as.factor(L.stats$sparsity)
with(L.stats, summary(aov(value~variable*sparsity)))
with(L.stats, TukeyHSD(aov(value~variable*sparsity)))
```

```{r}
# extract over-modeling index ####
O_C.D500<-ext.OI(C.D500)
O_C.D1000<-ext.OI(C.D1000)
O_C.D2000<-ext.OI(C.D2000)
O_C.D10000<-ext.OI(C.D10000)

O_G.D500<-ext.OI(G.D500)
O_G.D1000<-ext.OI(G.D1000)
O_G.D2000<-ext.OI(G.D2000)
O_G.D10000<-ext.OI(G.D10000)

O_E.D500<-ext.OI(E.D500)
O_E.D1000<-ext.OI(E.D1000)
O_E.D2000<-ext.OI(E.D2000)
O_E.D10000<-ext.OI(E.D10000)

O_S.D500<-ext.OI(S.D500)
O_S.D1000<-ext.OI(S.D1000)
O_S.D2000<-ext.OI(S.D2000)
O_S.D10000<-ext.OI(S.D10000)

O_V.D500<-ext.OI(V.D500)
O_V.D1000<-ext.OI(V.D1000)
O_V.D2000<-ext.OI(V.D2000)
O_V.D10000<-ext.OI(V.D10000)
# prepare to plot overmodeling index 
O_C.D500$Level<-c(rep(500, 100))
O_C.D1000$Level<-c(rep(1000, 100))
O_C.D2000$Level<-c(rep(2000, 100))
O_C.D10000$Level<-c(rep(10000, 100))

O_G.D500$Level<-c(rep(500, 100))
O_G.D1000$Level<-c(rep(1000, 100))
O_G.D2000$Level<-c(rep(2000, 100))
O_G.D10000$Level<-c(rep(10000, 100))

O_E.D500$Level<-c(rep(500, 100))
O_E.D1000$Level<-c(rep(1000, 100))
O_E.D2000$Level<-c(rep(2000, 100))
O_E.D10000$Level<-c(rep(10000, 100))

O_S.D500$Level<-c(rep(500, 100))
O_S.D1000$Level<-c(rep(1000, 100))
O_S.D2000$Level<-c(rep(2000, 100))
O_S.D10000$Level<-c(rep(10000, 100))

O_V.D500$Level<-c(rep(500, 100))
O_V.D1000$Level<-c(rep(1000, 100))
O_V.D2000$Level<-c(rep(2000, 100))
O_V.D10000$Level<-c(rep(10000, 100))

```

```{r}
# plot overmodeling index ####
OI.C<-do.call("rbind", list(O_C.D500,O_C.D1000,O_C.D2000,O_C.D10000))
OI.C<-melt(data=OI.C, id.vars="Level", measure.vars = c("raw", "scaled", "eRare", "pRare", "limmaVST", "deseqVST"))
OI.C<-data_summary2(OI.C, varname="value", groupnames=c("Level", "variable"))

ggplot(OI.C, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("Overmodeling Index Value (Median +/- min/max)")+
  theme_classic()
```

```{r}
OI.G<-do.call("rbind", list(O_G.D500,O_G.D1000,O_G.D2000,O_G.D10000))
OI.G<-melt(data=OI.G, id.vars="Level", measure.vars = c("raw", "scaled", "eRare", "pRare", "limmaVST", "deseqVST"))
OI.G<-data_summary2(OI.G, varname="value", groupnames=c("Level", "variable"))

ggplot(OI.G, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("Overmodeling Index Value (Median +/- min/max)")+
  theme_classic()

```

```{r}
OI.E<-do.call("rbind", list(O_E.D500,O_E.D1000,O_E.D2000,O_E.D10000))
OI.E<-melt(data=OI.E, id.vars="Level", measure.vars = c("raw", "scaled", "eRare", "pRare", "limmaVST", "deseqVST"))
OI.E<-data_summary2(OI.E, varname="value", groupnames=c("Level", "variable"))

ggplot(OI.E, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("Overmodeling Index Value (Median +/- min/max)")+
  theme_classic()
```

```{r}
OI.S<-do.call("rbind", list(O_S.D500,O_S.D1000,O_S.D2000,O_S.D10000))
OI.S<-melt(data=OI.S, id.vars="Level", measure.vars = c("raw", "scaled", "eRare", "pRare", "limmaVST", "deseqVST"))
OI.S<-data_summary2(OI.S, varname="value", groupnames=c("Level", "variable"))

ggplot(OI.S, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("Overmodeling Index Value (Median +/- min/max)")+
  theme_classic()
```

```{r}
OI.V<-do.call("rbind", list(O_V.D500,O_V.D1000,O_V.D2000,O_V.D10000))
OI.V<-melt(data=OI.V, id.vars="Level", measure.vars = c("raw", "scaled", "eRare", "pRare", "limmaVST", "deseqVST"))
OI.V<-data_summary2(OI.V, varname="value", groupnames=c("Level", "variable"))

ggplot(OI.C, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("Overmodeling Index Value (Median +/- min/max)")+
  theme_classic()

```
```{r}
with(plot())
```

```{r}
OI.C$sparsity<-c(rep(1, 24))
OI.E$sparsity<-c(rep(3, 24))
OI.G$sparsity<-c(rep(2, 24))
OI.S$sparsity<-c(rep(4, 24))
OI.V$sparsity<-c(rep(5, 24))

O.stats<-do.call("rbind", list(OI.C, OI.E, OI.G, OI.S, OI.V))
O.stats$sparsity<-as.factor(O.stats$sparsity)
with(O.stats, summary(aov(value~variable*sparsity)))
with(O.stats, TukeyHSD(aov(value~variable*sparsity)))
```

