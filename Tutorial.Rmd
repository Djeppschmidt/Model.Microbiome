---
title: "Model Microbiome Tutorial"
author: "Dietrich Epp Schmidt"
date: "2/21/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:
```{r}
# load required packages ####

library(Model.Microbiome)
library(ggplot2)
library(vegan)
#library(dplyr)
#library(plyr)
library(phyloseq)
library()
```

```{r}
# mostly universal taxa
# benchmark with total = 75; different sequencing depth (low sparsity)
#Test runs:
C.D500<-suppressWarnings(benchmark.MM(reps=1, commonN=73, groupN=1, singleN=1, D=500, V=250))

#
C.D500<-suppressWarnings(benchmark.MM(reps=100, commonN=73, groupN=1, singleN=1, D=500, V=250))
C.D1000<-suppressWarnings(benchmark.MM(reps=100, commonN=73, groupN=1, singleN=1, D=1000, V=500))
C.D2000<-suppressWarnings(benchmark.MM(reps=100, commonN=73, groupN=1, singleN=1, D=2000, V=1000))
C.D10000<-suppressWarnings(benchmark.MM(reps=100, commonN=73, groupN=1, singleN=1, D=10000, V=5000))

# increasing rare taxa (medium-low sparsity)
# benchmark with total = 75; different sequencing depth
G.D500<-suppressWarnings(benchmark.MM(reps=100, commonN=50, groupN=15, singleN=10, D=500, V=250))
G.D1000<-suppressWarnings(benchmark.MM(reps=100, commonN=50, groupN=15, singleN=10, D=1000, V=500))
G.D2000<-suppressWarnings(benchmark.MM(reps=100, commonN=50, groupN=15, singleN=10, D=2000, V=1000))
G.D10000<-suppressWarnings(benchmark.MM(reps=100, commonN=50, groupN=15, singleN=10, D=10000, V=5000))

# even distribution of rare taxa (medium sparcity)
# benchmark with total = 75; different sequencing depth
E.D500<-suppressWarnings(benchmark.MM(reps=100, commonN=25, groupN=25, singleN=25, D=500, V=250))
E.D1000<-suppressWarnings(benchmark.MM(reps=100, commonN=25, groupN=25, singleN=25, D=1000, V=500))
E.D2000<-suppressWarnings(benchmark.MM(reps=100, commonN=25, groupN=25, singleN=25, D=2000, V=1000))
E.D10000<-suppressWarnings(benchmark.MM(reps=100, commonN=25, groupN=25, singleN=25, D=10000, V=5000))

# (medium-high sparsity)
# benchmark with total = 75; different sequencing depth
S.D500<-suppressWarnings(benchmark.MM(reps=100, commonN=15, groupN=20, singleN=40, D=500, V=250))
S.D1000<-suppressWarnings(benchmark.MM(reps=100, commonN=15, groupN=20, singleN=40, D=1000, V=500))
S.D2000<-suppressWarnings(benchmark.MM(reps=100, commonN=15, groupN=20, singleN=40, D=2000, V=1000)) 
S.D10000<-suppressWarnings(benchmark.MM(reps=100, commonN=15, groupN=20, singleN=40, D=10000, V=5000)) 

# (High sparsity)
# benchmark with total = 75; different sequencing depth
V.D500<-suppressWarnings(benchmark.MM(reps=100, commonN=10, groupN=15, singleN=50, D=500, V=250))
V.D1000<-suppressWarnings(benchmark.MM(reps=100, commonN=10, groupN=15, singleN=50, D=1000, V=500))
V.D2000<-suppressWarnings(benchmark.MM(reps=100, commonN=10, groupN=15, singleN=50, D=2000, V=1000))
V.D10000<-suppressWarnings(benchmark.MM(reps=100, commonN=10, groupN=15, singleN=50, D=10000, V=5000))
```
```{R}
# boxplot of R squared from model
box.df<-data.frame("reference"=C.D500$rep1$model$R$lm,"deseqVST"=C.D500$rep1$deseqVST$OI$R$lm,"limmaVST"=C.D500$rep1$limma$OI$R$lm,"RA"=C.D500$rep1$RA$OI$R$lm,"erare"=C.D500$rep1$eRare$OI$R$lm,"scaled"=C.D500$rep1$scaled$OI$R$lm)
box.df$names<-rownames(box.df)
m.box<-melt(data=box.df, id.vars="names", measure.vars = c("reference", "RA", "scaled", "erare", "limmaVST", "deseqVST"))

ggplot(m.box, aes(x=variable, y=value))+
  #geom_violin() +
  geom_boxplot()+
  geom_jitter()+
  theme_classic()
    
```


```{R}
# PERMANOVA output ####

# benchmark with total = 75; different sequencing depth
P_C.D500<-ext.PERMANOVA(C.D500)
P_C.D1000<-ext.PERMANOVA(C.D1000)
P_C.D2000<-ext.PERMANOVA(C.D2000)
P_C.D10000<-ext.PERMANOVA(C.D10000)
# seq depth at mostly universal taxa
# benchmark with total = 75; different sequencing depth
P_G.D500<-ext.PERMANOVA(G.D500)
P_G.D1000<-ext.PERMANOVA(G.D1000)
P_G.D2000<-ext.PERMANOVA(G.D2000)
P_G.D10000<-ext.PERMANOVA(G.D10000)

# seq depth at mostly universal taxa
# benchmark with total = 75; different sequencing depth
P_S.D500<-ext.PERMANOVA(S.D500)
P_S.D1000<-ext.PERMANOVA(S.D1000)
P_S.D2000<-ext.PERMANOVA(S.D2000)
P_S.D10000<-ext.PERMANOVA(S.D10000)

# seq depth at mostly universal taxa
# benchmark with total = 75; different sequencing depth
P_E.D500<-ext.PERMANOVA(E.D500)
P_E.D1000<-ext.PERMANOVA(E.D1000)
P_E.D2000<-ext.PERMANOVA(E.D2000)
P_E.D10000<-ext.PERMANOVA(E.D10000)

P_V.D500<-ext.PERMANOVA(V.D500)
P_V.D1000<-ext.PERMANOVA(V.D1000)
P_V.D2000<-ext.PERMANOVA(V.D2000)
P_V.D10000<-ext.PERMANOVA(V.D10000)
```

```{r}
# prepare permanova data for plotting ####

P_C.D500$Level<-c(rep(500, 100))
P_C.D1000$Level<-c(rep(1000, 100))
P_C.D2000$Level<-c(rep(2000, 100))
P_C.D10000$Level<-c(rep(10000, 100))

P_G.D500$Level<-c(rep(500, 100))
P_G.D1000$Level<-c(rep(1000, 100))
P_G.D2000$Level<-c(rep(2000, 100))
P_G.D10000$Level<-c(rep(10000, 100))

P_E.D500$Level<-c(rep(500, 100))
P_E.D1000$Level<-c(rep(1000, 100))
P_E.D2000$Level<-c(rep(2000, 100))
P_E.D10000$Level<-c(rep(10000, 100))

P_S.D500$Level<-c(rep(500, 100))
P_S.D1000$Level<-c(rep(1000, 100))
P_S.D2000$Level<-c(rep(2000, 100))
P_S.D10000$Level<-c(rep(10000, 100))

P_V.D500$Level<-c(rep(500, 100))
P_V.D1000$Level<-c(rep(1000, 100))
P_V.D2000$Level<-c(rep(2000, 100))
P_V.D10000$Level<-c(rep(10000, 100))

#rep
P_C.D500$rep<-c(1:100)
P_C.D1000$rep<-c(101:200)
P_C.D2000$rep<-c(201:300)
P_C.D10000$rep<-c(301:400)

P_G.D500$rep<-c(501:600)
P_G.D1000$rep<-c(601:700)
P_G.D2000$rep<-c(701:800)
P_G.D10000$rep<-c(801:900)

P_E.D500$rep<-c(901:1000)
P_E.D1000$rep<-c(1001:1100)
P_E.D2000$rep<-c(1101:1200)
P_E.D10000$rep<-c(1201:1300)

P_S.D500$rep<-c(1301:1400)
P_S.D1000$rep<-c(1401:1500)
P_S.D2000$rep<-c(1501:1600)
P_S.D10000$rep<-c(1601:1700)

P_V.D500$rep<-c(1701:1800)
P_V.D1000$rep<-c(1801:1900)
P_V.D2000$rep<-c(1901:2000)
P_V.D10000$rep<-c(2001:2100)
```

```{r}
# permanova plots

Permanova.C<-do.call("rbind", list(P_C.D500,P_C.D1000,P_C.D2000,P_C.D10000))
Permanova.C2<-melt(data=Permanova.C, id.vars="Level", measure.vars = c("raw", "RA", "scaled", "eRare", "pRare", "limmaVST", "deseqVST", "deseqVST_scaled"))
library(ggplot2)

Permanova.C3<-data_summary2(Permanova.C2, varname="value", groupnames=c("Level", "variable"))
Permanova.C2<-data_summary(Permanova.C2, varname="value", groupnames=c("Level", "variable"))

ggplot(Permanova.C2, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=value-sd, ymax=value+sd), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("PERMANOVA R.sq. Index Value (Mean +/- se)")+
  theme_classic()


ggplot(Permanova.C3, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("PERMANOVA R.sq. Index Value (Median +/- min/max)")+
  theme_classic()
```

```{r}
# permanova plots

Permanova.G<-do.call("rbind", list(P_G.D500,P_G.D1000,P_G.D2000,P_G.D10000))
Permanova.G2<-melt(data=Permanova.G, id.vars="Level", measure.vars = c("raw","RA", "scaled", "eRare", "pRare", "limmaVST", "deseqVST", "deseqVST_scaled"))

Permanova.G3<-data_summary2(Permanova.G2, varname="value", groupnames=c("Level", "variable"))
Permanova.G2<-data_summary(Permanova.G2, varname="value", groupnames=c("Level", "variable"))

ggplot(Permanova.G2, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=value-sd, ymax=value+sd), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("PERMANOVA R.sq. Index Value (Mean +/- se)")+
  theme_classic()


ggplot(Permanova.G3, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("PERMANOVA R.sq. Index Value (Median +/- min/max)")+
  theme_classic()
```

```{r}
# permanova plots

Permanova.E<-do.call("rbind", list(P_E.D500,P_E.D1000,P_E.D2000,P_E.D10000))
Permanova.E2<-melt(data=Permanova.E, id.vars="Level", measure.vars = c("raw","RA", "scaled", "eRare", "pRare", "limmaVST", "deseqVST", "deseqVST_scaled"))

Permanova.E3<-data_summary2(Permanova.E2, varname="value", groupnames=c("Level", "variable"))
Permanova.E2<-data_summary(Permanova.E2, varname="value", groupnames=c("Level", "variable"))

ggplot(Permanova.E2, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=value-sd, ymax=value+sd), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("PERMANOVA R.sq. Index Value (Mean +/- se)")+
  theme_classic()


ggplot(Permanova.E3, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("PERMANOVA R.sq. Index Value (Median +/- min/max)")+
  theme_classic()
```

```{r}
# permanova plots

Permanova.S<-do.call("rbind", list(P_S.D500,P_S.D1000,P_S.D2000,P_S.D10000))
Permanova.S2<-melt(data=Permanova.S, id.vars="Level", measure.vars = c("raw","RA", "scaled", "eRare", "pRare", "limmaVST", "deseqVST", "deseqVST_scaled"))

Permanova.S3<-data_summary2(Permanova.S2, varname="value", groupnames=c("Level", "variable"))
Permanova.S2<-data_summary(Permanova.S2, varname="value", groupnames=c("Level", "variable"))

ggplot(Permanova.S2, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=value-sd, ymax=value+sd), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("PERMANOVA R.sq. Index Value (Mean +/- se)")+
  theme_classic()


ggplot(Permanova.S3, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("PERMANOVA R.sq. Index Value (Median +/- min/max)")+
  theme_classic()
```


```{r}
# permanova plots

Permanova.V<-do.call("rbind", list(P_V.D500,P_V.D1000,P_V.D2000,P_V.D10000))
Permanova.V2<-melt(data=Permanova.V, id.vars="Level", measure.vars = c("raw","RA", "scaled", "eRare", "pRare", "limmaVST", "deseqVST", "deseqVST_scaled"))

Permanova.V3<-data_summary2(Permanova.V2, varname="value", groupnames=c("Level", "variable"))
Permanova.V2<-data_summary(Permanova.V2, varname="value", groupnames=c("Level", "variable"))

ggplot(Permanova.V2, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=value-sd, ymax=value+sd), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("PERMANOVA R.sq. Index Value (Mean +/- se)")+
  theme_classic()


ggplot(Permanova.V3, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("PERMANOVA R.sq. Index Value (Median +/- min/max)")+
  theme_classic()
```
```{r}
Permanova.C$sparsity<-c(rep(1, 400))
Permanova.E$sparsity<-c(rep(3, 400))
Permanova.G$sparsity<-c(rep(2, 400))
Permanova.S$sparsity<-c(rep(4, 400))
Permanova.V$sparsity<-c(rep(5, 400))

Permanova.stats<-do.call("rbind", list(Permanova.C, Permanova.E, Permanova.G, Permanova.S, Permanova.V))
Permanova.stats$sparsity<-as.factor(Permanova.stats$sparsity)
Permanova.stats$rep<-as.factor(Permanova.stats$rep)
#Permanova.stats$sparsity<-as.factor(Permanova.stats$sparsity)
P.stats<-melt(data=Permanova.stats, id.vars=c("Level","rep", "sparsity"), measure.vars = c("raw","RA", "scaled", "eRare", "pRare", "limmaVST", "deseqVST", "deseqVST_scaled"))

summary(aov(value~variable*sparsity+variable:rep, data=P.stats))
TukeyHSD(aov(value~variable*sparsity+variable:rep, data=P.stats))
```


```{r}
# LII output ####

# benchmark with total = 75; different sequencing depth
L_C.D500<-ext.LII(C.D500)
L_C.D1000<-ext.LII(C.D1000)
L_C.D2000<-ext.LII(C.D2000)
L_C.D10000<-ext.LII(C.D10000)
# seq depth at mostly universal taxa
# benchmark with total = 75; different sequencing depth
L_G.D500<-ext.LII(G.D500)
L_G.D1000<-ext.LII(G.D1000)
L_G.D2000<-ext.LII(G.D2000)
L_G.D10000<-ext.LII(G.D10000)

# seq depth at mostly universal taxa
# benchmark with total = 75; different sequencing depth
L_E.D500<-ext.LII(E.D500)
L_E.D1000<-ext.LII(E.D1000)
L_E.D2000<-ext.LII(E.D2000)
L_E.D10000<-ext.LII(E.D10000)

# seq depth at mostly universal taxa
# benchmark with total = 75; different sequencing depth
L_S.D500<-ext.LII(S.D500)
L_S.D1000<-ext.LII(S.D1000)
L_S.D2000<-ext.LII(S.D2000)
L_S.D10000<-ext.LII(S.D10000)

L_V.D500<-ext.LII(S.D500)
L_V.D1000<-ext.LII(S.D1000)
L_V.D2000<-ext.LII(S.D2000)
L_V.D10000<-ext.LII(S.D10000)

# prepare Loss of information for plotting

L_C.D500$Level<-c(rep(500, 100))
L_C.D1000$Level<-c(rep(1000, 100))
L_C.D2000$Level<-c(rep(2000, 100))
L_C.D10000$Level<-c(rep(10000, 100))

L_G.D500$Level<-c(rep(500, 100))
L_G.D1000$Level<-c(rep(1000, 100))
L_G.D2000$Level<-c(rep(2000, 100))
L_G.D10000$Level<-c(rep(10000, 100))

L_E.D500$Level<-c(rep(500, 100))
L_E.D1000$Level<-c(rep(1000, 100))
L_E.D2000$Level<-c(rep(2000, 100))
L_E.D10000$Level<-c(rep(10000, 100))

L_S.D500$Level<-c(rep(500, 100))
L_S.D1000$Level<-c(rep(1000, 100))
L_S.D2000$Level<-c(rep(2000, 100))
L_S.D10000$Level<-c(rep(10000, 100))

L_V.D500$Level<-c(rep(500, 100))
L_V.D1000$Level<-c(rep(1000, 100))
L_V.D2000$Level<-c(rep(2000, 100))
L_V.D10000$Level<-c(rep(10000, 100))

# rep
L_C.D500$rep<-c(1:100)
L_C.D1000$rep<-c(101:200)
L_C.D2000$rep<-c(201:300)
L_C.D10000$rep<-c(301:400)

L_G.D500$rep<-c(401:500)
L_G.D1000$rep<-c(501:600)
L_G.D2000$rep<-c(601:700)
L_G.D10000$rep<-c(701:800)

L_E.D500$rep<-c(801:900)
L_E.D1000$rep<-c(901:1000)
L_E.D2000$rep<-c(1001:1100)
L_E.D10000$rep<-c(1101:1200)

L_S.D500$rep<-c(1201:1300)
L_S.D1000$rep<-c(1301:1400)
L_S.D2000$rep<-c(1401:1500)
L_S.D10000$rep<-c(1601:1700)

L_V.D500$rep<-c(1801:1900)
L_V.D1000$rep<-c(2001:2100)
L_V.D2000$rep<-c(2101:2200)
L_V.D10000$rep<-c(2201:2300)

```

```{R}
# plot LII ####
LII.C<-do.call("rbind", list(L_C.D500,L_C.D1000,L_C.D2000,L_C.D10000))
LII.C2<-melt(data=LII.C, id.vars="Level", measure.vars = c("raw","RA", "scaled", "eRare", "pRare", "limmaVST", "deseqVST", "deseqVST_scaled"))
LII.C2<-data_summary2(LII.C, varname="value", groupnames=c("Level", "variable"))

LII.C500<-LII.C[LII.C$Level==500,]
LII.C1000<-LII.C[LII.C$Level==1000,]
LII.C2000<-LII.C[LII.C$Level==2000,]
LII.C10000<-LII.C[LII.C$Level==10000,]

ggplot(LII.C, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line()+
  geom_point()+
  xlab("Seq. Depth")+
  ylab("Lost Information Index Value (Median +/- min/max)")+
  theme_classic()

```

```{R}


LII.G<-do.call("rbind", list(L_G.D500,L_G.D1000,L_G.D2000,L_G.D10000))
LII.G2<-melt(data=LII.G, id.vars="Level", measure.vars = c("raw","RA", "scaled", "eRare", "pRare", "limmaVST", "deseqVST", "deseqVST_scaled"))
LII.G2<-data_summary2(LII.G2, varname="value", groupnames=c("Level", "variable"))

LII.G500<-LII.G[LII.G$Level==500,]
LII.G1000<-LII.G[LII.G$Level==1000,]
LII.G2000<-LII.G[LII.G$Level==2000,]
LII.G10000<-LII.G[LII.G$Level==10000,]

ggplot(LII.G, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line()+
  geom_point()+
  xlab("Seq. Depth")+
  ylab("Lost Information Index Value (Median +/- min/max)")+
  theme_classic()

```

```{R}

LII.E<-do.call("rbind", list(L_E.D500,L_E.D1000,L_E.D2000,L_E.D10000))
LII.E2<-melt(data=LII.E, id.vars="Level", measure.vars = c("raw","RA", "scaled", "eRare", "pRare", "limmaVST", "deseqVST", "deseqVST_scaled"))
LII.E2<-data_summary2(LII.E2, varname="value", groupnames=c("Level", "variable"))

LII.E500<-LII.E[LII.E$Level==500,]
LII.E1000<-LII.E[LII.E$Level==1000,]
LII.E2000<-LII.E[LII.E$Level==2000,]
LII.E10000<-LII.E[LII.E$Level==10000,]

ggplot(LII.E, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("Lost Information Index Value (Median +/- min/max)")+
  theme_classic()

```

```{R}

LII.S<-do.call("rbind", list(L_S.D500,L_S.D1000,L_S.D2000,L_S.D10000))
LII.S2<-melt(data=LII.S, id.vars="Level", measure.vars = c("raw","RA", "scaled", "eRare", "pRare", "limmaVST", "deseqVST", "deseqVST_scaled"))
LII.S2<-data_summary2(LII.S2, varname="value", groupnames=c("Level", "variable"))

LII.S500<-LII.S[LII.S$Level==500,]
LII.S1000<-LII.S[LII.S$Level==1000,]
LII.S2000<-LII.S[LII.S$Level==2000,]
LII.S10000<-LII.S[LII.S$Level==10000,]

ggplot(LII.S, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("Lost Information Index Value (Median +/- min/max)")+
  theme_classic()

```

```{R}

LII.V<-do.call("rbind", list(L_V.D500,L_V.D1000,L_V.D2000,L_V.D10000))
LII.V2<-melt(data=LII.V, id.vars="Level", measure.vars = c("raw","RA", "scaled", "eRare", "pRare", "limmaVST", "deseqVST", "deseqVST_scaled"))
LII.V2<-data_summary2(LII.V2, varname="value", groupnames=c("Level", "variable"))

LII.V500<-LII.V[LII.V$Level==500,]
LII.V1000<-LII.V[LII.V$Level==1000,]
LII.V2000<-LII.V[LII.V$Level==2000,]
LII.V10000<-LII.V[LII.V$Level==10000,]

ggplot(LII.V, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("Lost Information Index Value (Median +/- min/max)")+
  theme_classic()

```


```{r}
with(LII.V, plot())
```


```{r}
LII.C$sparsity<-c(rep(1, 400))
LII.E$sparsity<-c(rep(3, 400))
LII.G$sparsity<-c(rep(2, 400))
LII.S$sparsity<-c(rep(4, 400))
LII.V$sparsity<-c(rep(5, 400))

L.stats<-do.call("rbind", list(LII.C, LII.E, LII.G, LII.S, LII.V))
L.stats<-melt(data=L.stats, id.vars=c("Level","rep", "sparsity"), measure.vars = c("raw","RA", "scaled", "eRare", "pRare", "limmaVST", "deseqVST", "deseqVST_scaled"))

summary(aov(value~variable*sparsity+variable:rep, data=L.stats))
TukeyHSD(aov(value~variable*sparsity+variable:rep, data=L.stats))
```

```{r}
# extract over-modeling index ####
O_C.D500<-ext.OI(C.D500)
O_C.D1000<-ext.OI(C.D1000)
O_C.D2000<-ext.OI(C.D2000)
O_C.D10000<-ext.OI(C.D10000)

O_G.D500<-ext.OI(G.D500)
O_G.D1000<-ext.OI(G.D1000)
O_G.D2000<-ext.OI(G.D2000)
O_G.D10000<-ext.OI(G.D10000)

O_E.D500<-ext.OI(E.D500)
O_E.D1000<-ext.OI(E.D1000)
O_E.D2000<-ext.OI(E.D2000)
O_E.D10000<-ext.OI(E.D10000)

O_S.D500<-ext.OI(S.D500)
O_S.D1000<-ext.OI(S.D1000)
O_S.D2000<-ext.OI(S.D2000)
O_S.D10000<-ext.OI(S.D10000)

O_V.D500<-ext.OI(V.D500)
O_V.D1000<-ext.OI(V.D1000)
O_V.D2000<-ext.OI(V.D2000)
O_V.D10000<-ext.OI(V.D10000)
# prepare to plot overmodeling index 
O_C.D500$Level<-c(rep(500, 100))
O_C.D1000$Level<-c(rep(1000, 100))
O_C.D2000$Level<-c(rep(2000, 100))
O_C.D10000$Level<-c(rep(10000, 100))

O_G.D500$Level<-c(rep(500, 100))
O_G.D1000$Level<-c(rep(1000, 100))
O_G.D2000$Level<-c(rep(2000, 100))
O_G.D10000$Level<-c(rep(10000, 100))

O_E.D500$Level<-c(rep(500, 100))
O_E.D1000$Level<-c(rep(1000, 100))
O_E.D2000$Level<-c(rep(2000, 100))
O_E.D10000$Level<-c(rep(10000, 100))

O_S.D500$Level<-c(rep(500, 100))
O_S.D1000$Level<-c(rep(1000, 100))
O_S.D2000$Level<-c(rep(2000, 100))
O_S.D10000$Level<-c(rep(10000, 100))

O_V.D500$Level<-c(rep(500, 100))
O_V.D1000$Level<-c(rep(1000, 100))
O_V.D2000$Level<-c(rep(2000, 100))
O_V.D10000$Level<-c(rep(10000, 100))

# rep

O_C.D500$rep<-c(1:100)
O_C.D1000$rep<-c(101:200)
O_C.D2000$rep<-c(201:300)
O_C.D10000$rep<-c(301:400)

O_G.D500$rep<-c(401:500)
O_G.D1000$rep<-c(601:700)
O_G.D2000$rep<-c(701:800)
O_G.D10000$rep<-c(801:900)

O_E.D500$rep<-c(901:1000)
O_E.D1000$rep<-c(1001:1100)
O_E.D2000$rep<-c(1101:1200)
O_E.D10000$rep<-c(1201:1300)

O_S.D500$rep<-c(1301:1400)
O_S.D1000$rep<-c(1401:1500)
O_S.D2000$rep<-c(1501:1600)
O_S.D10000$rep<-c(1601:1700)

O_V.D500$rep<-c(1701:1800)
O_V.D1000$rep<-c(1801:1900)
O_V.D2000$rep<-c(1901:2000)
O_V.D10000$rep<-c(2001:2100)
```

```{r}
# plot overmodeling index ####
OI.C<-do.call("rbind", list(O_C.D500,O_C.D1000,O_C.D2000,O_C.D10000))
OI.C2<-melt(data=OI.C, id.vars="Level", measure.vars = c("raw","RA", "scaled", "eRare", "pRare", "limmaVST", "deseqVST", "deseqVST_scaled"))
OI.C2<-data_summary2(OI.C2, varname="value", groupnames=c("Level", "variable"))

ggplot(OI.C, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("Overmodeling Index Value (Median +/- min/max)")+
  theme_classic()
```

```{r}
OI.G<-do.call("rbind", list(O_G.D500,O_G.D1000,O_G.D2000,O_G.D10000))
OI.G2<-melt(data=OI.G, id.vars="Level", measure.vars = c("raw","RA", "scaled", "eRare", "pRare", "limmaVST", "deseqVST", "deseqVST_scaled"))
OI.G2<-data_summary2(OI.G2, varname="value", groupnames=c("Level", "variable"))

ggplot(OI.G, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("Overmodeling Index Value (Median +/- min/max)")+
  theme_classic()

```

```{r}
OI.E<-do.call("rbind", list(O_E.D500,O_E.D1000,O_E.D2000,O_E.D10000))
OI.E2<-melt(data=OI.E, id.vars="Level", measure.vars = c("raw","RA", "scaled", "eRare", "pRare", "limmaVST", "deseqVST", "deseqVST_scaled"))
OI.E2<-data_summary2(OI.E2, varname="value", groupnames=c("Level", "variable"))

ggplot(OI.E, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("Overmodeling Index Value (Median +/- min/max)")+
  theme_classic()
```

```{r}
OI.S<-do.call("rbind", list(O_S.D500,O_S.D1000,O_S.D2000,O_S.D10000))
OI.S2<-melt(data=OI.S, id.vars="Level", measure.vars = c("raw","RA", "scaled", "eRare", "pRare", "limmaVST", "deseqVST", "deseqVST_scaled"))
OI.S2<-data_summary2(OI.S2, varname="value", groupnames=c("Level", "variable"))

ggplot(OI.S, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("Overmodeling Index Value (Median +/- min/max)")+
  theme_classic()
```

```{r}
OI.V<-do.call("rbind", list(O_V.D500,O_V.D1000,O_V.D2000,O_V.D10000))
OI.V2<-melt(data=OI.V, id.vars="Level", measure.vars = c("raw","RA", "scaled", "eRare", "pRare", "limmaVST", "deseqVST", "deseqVST_scaled"))
OI.V2<-data_summary2(OI.V2, varname="value", groupnames=c("Level", "variable"))

ggplot(OI.C, aes(x=Level, y=value, group = variable, color=variable))+
  geom_errorbar(aes(ymin=low, ymax=high), width=.1, position=position_dodge(300)) +
  geom_line(position=position_dodge(300))+
  geom_point(position=position_dodge(300))+
  xlab("Seq. Depth")+
  ylab("Overmodeling Index Value (Median +/- min/max)")+
  theme_classic()

```
```{r}
with(plot())
```

```{r}
OI.C$sparsity<-c(rep(1, 400))
OI.E$sparsity<-c(rep(3, 400))
OI.G$sparsity<-c(rep(2, 400))
OI.S$sparsity<-c(rep(4, 400))
OI.V$sparsity<-c(rep(5, 400))

O.stats<-do.call("rbind", list(OI.C, OI.E, OI.G, OI.S, OI.V))
#O.stats$sparsity<-as.factor(O.stats$sparsity)
O.stats<-melt(data=O.stats, id.vars=c("Level", "rep", "sparsity"), measure.vars = c("raw","RA", "scaled", "eRare", "pRare", "limmaVST", "deseqVST", "deseqVST_scaled"))

summary(aov(value~variable*sparsity+variable:rep, data=O.stats))
TukeyHSD(aov(value~variable*sparsity+variable:rep, data=O.stats))
```

